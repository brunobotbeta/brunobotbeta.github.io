<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrunoBot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: url('https://londonmymind.com/wp-content/uploads/2022/01/Sunset-in-London-Hero-2-1024x683.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 0;
        }

        .container {
            margin-top: 10%;
        }

        input, button {
            padding: 10px;
            font-size: 16px;
            margin: 5px;
            border-radius: 5px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
        }

        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 id="welcome"></h1>
        <div>
            <input type="text" id="input" placeholder="Ask me something...">
            <button onclick="processInput()">Submit</button>
        </div>
        <p id="output"></p>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        // User Session Management
        const loggedInUser = localStorage.getItem('loggedInUser');
        let userName = localStorage.getItem('userName') || loggedInUser || 'Guest';
        let favoriteCity = localStorage.getItem('favoriteCity') || null;

        // Set Welcome Message
        document.addEventListener('DOMContentLoaded', () => {
            if (!loggedInUser) {
                window.location.href = 'login.html'; // Redirect if not logged in
            } else {
                document.getElementById('welcome').textContent = `Welcome, ${userName}! Ask me anything!`;
            }
        });

        // Logout Functionality
        function logout() {
            localStorage.removeItem('loggedInUser');
            localStorage.removeItem('userName');
            localStorage.removeItem('favoriteCity');
            window.location.href = 'login.html';
        }

        // Process User Input
        function processInput() {
            const input = document.getElementById('input').value.toLowerCase();
            const output = document.getElementById('output');

            // Map of Responses
            const responses = {
                "hello": "Hi there! How can I help you?",
                "hi": "Hello! What's on your mind?",
                "what's the time in london": () => fetchTime("Europe/London"),
                "what's the weather in london": () => fetchWeather("London"),
                "what is my name": () => `Your name is ${userName}.`,
                "set my name to": (query) => {
                    const name = query.replace("set my name to ", "").trim();
                    userName = name.charAt(0).toUpperCase() + name.slice(1);
                    localStorage.setItem('userName', userName);
                    return `Nice to meet you, ${userName}!`;
                },
                "what's my favorite city": () => {
                    if (favoriteCity) {
                        return `Your favorite city is ${favoriteCity}.`;
                    } else {
                        return "I don't know your favorite city yet.";
                    }
                },
                "set my favorite city to": (query) => {
                    const city = query.replace("set my favorite city to ", "").trim();
                    favoriteCity = city.charAt(0).toUpperCase() + city.slice(1);
                    localStorage.setItem('favoriteCity', favoriteCity);
                    return `${favoriteCity} is now your favorite city!`;
                },
                "play brunle": "Let's play Brunle! Guess the 5-letter word.",
                "what is 2+2": "It's 4!"
            };

            // Process User Input
            const matchedResponse = Object.keys(responses).find((key) =>
                input.startsWith(key)
            );

            if (matchedResponse) {
                const reply = responses[matchedResponse];
                if (typeof reply === "function") {
                    output.textContent = reply(input);
                } else {
                    output.textContent = reply;
                }
            } else {
                output.textContent = "I didn't understand that. Please try again.";
            }
        }

        // Fetch Time Data
        function fetchTime(timezone) {
            const output = document.getElementById('output');
            try {
                const now = new Date().toLocaleString("en-GB", { timeZone: timezone });
                output.textContent = `The current time in ${timezone} is ${now}.`;
            } catch (err) {
                output.textContent = "I couldn't fetch the time. Please try again.";
            }
        }

        // Fetch Weather Data
        function fetchWeather(city) {
            const apiKey = "434ce40c5261c3ea43477f902ee0fd78";
            fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}`)
                .then((response) => response.json())
                .then((data) => {
                    const tempCelsius = (data.main.temp - 273.15).toFixed(2);
                    document.getElementById('output').textContent = `The weather in ${city} is ${tempCelsius}Â°C with ${data.weather[0].description}.`;
                })
                .catch(() => {
                    document.getElementById('output').textContent = `I couldn't find the weather for ${city}. Please try another city.`;
                });
        }
    </script>
</body>
</html>